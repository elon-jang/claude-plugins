# Lessons & Learned

> 세션별 회고. 발견 → 원인분석 → 교훈 순으로 기록.

---

## 2026-02-05 — published_date 필드 추가 (linked-insight)

### 1. LinkedIn HTML에서 날짜 추출은 작성자보다 더 불안정

**발견**: LinkedIn 포스트 HTML에서 게시일을 추출하려면 4단계 fallback이 필요. `<time datetime>` 태그가 가장 정확하지만, LinkedIn은 이를 항상 렌더링하지 않음. 상대 시간("2w", "3일 전")이 더 흔하게 노출됨.

**원인분석**: LinkedIn SPA는 서버사이드 렌더링 시점에 따라 HTML 구조가 달라짐. 피드 내 포스트 vs 직접 URL 접근 시 다른 셀렉터가 사용됨. 또한 영어/한국어 UI에서 상대 시간 표현이 완전히 다름 ("2w" vs "2주 전").

**교훈**: 웹 스크래핑에서 날짜 필드는 "있으면 좋고 없어도 동작" 설계가 필수. 빈 문자열 fallback + 수동 보정(backfill) 파이프라인을 처음부터 함께 만들어야 데이터 품질을 점진적으로 올릴 수 있음. author 추출과 동일한 교훈 — multi-layer fallback이 LinkedIn 스크래핑의 기본 패턴.

---

### 2. 새 메타데이터 필드 추가 시 4곳 동시 수정 패턴

**발견**: `published_date` 하나를 추가하는데 `fetch_post.py`, `linkedin-save.md`, `stats.py`, `backfill.py` 4개 파일을 수정해야 했음. 반면 `index.py`, `search.py`, `delete.py`, `migrate.py`는 메타데이터를 dict로 전달하므로 수정 불필요.

**원인분석**: 메타데이터 필드가 명시적으로 참조되는 곳(추출, 템플릿, 통계, 리포트)만 수정 필요. dict/frontmatter를 통째로 전달하는 코드는 자동으로 새 필드를 포함.

**교훈**: 새 메타데이터 필드 추가 체크리스트: (1) 추출 스크립트 (2) 저장 커맨드 템플릿 (3) 통계 (4) backfill 리포트. 이 4곳 패턴은 향후 필드 추가에도 재사용 가능. dict 기반 파이프라인 설계 덕분에 중간 단계(인덱싱, 검색, 삭제)는 자동 호환.

---

### 3. 상대 시간 파싱의 정확도 한계

**발견**: `_parse_relative_time("2w")` → 14일 전 날짜로 계산. 하지만 "2주 전"이 정확히 14일 전인지, 아니면 13~15일 범위인지는 LinkedIn이 어떻게 반올림하는지에 따라 다름.

**원인분석**: LinkedIn은 "2w"를 표시할 때 내부적으로 10~17일 범위를 모두 "2w"로 표현할 수 있음. 월 단위("1mo")는 28~31일 편차가 더 큼. `timedelta(days=num*30)`은 근사치일 뿐.

**교훈**: 상대 시간 기반 날짜는 +-수일 오차가 불가피. `published_date`가 상대 시간에서 파생된 경우 정확도가 낮다는 점을 사용자/문서에 명시하는 것이 좋음. 가능하면 `<time datetime>` ISO 형식을 우선 사용.

---
